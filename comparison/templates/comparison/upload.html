{% extends "comparison/base.html" %}
{% block content %}

<div class="max-w-5xl mx-auto bg-white shadow-xl rounded-2xl p-10">

    <h2 class="text-3xl font-bold mb-6">BOM Comparison Tool</h2>

    <!-- RULES -->
    <div class="mb-8 bg-indigo-50 border-l-4 border-indigo-500 p-5 rounded-lg">
        <h3 class="font-semibold text-lg mb-2">ðŸ“Œ File Upload Rules</h3>
        <ul class="list-disc ml-6 text-gray-700 space-y-1">
            <li>Master BOM must be <strong>.xlsx</strong></li>
            <li>Upload <strong>1â€“5 target files</strong></li>
            <li>Allowed target formats: <strong>XLSX, CSV, DOCX, PDF, TXT</strong></li>
            <li>File must have: <strong>MPN, Quantity, Ref Des, Description</strong></li>
        </ul>
    </div>

    <form method="post" enctype="multipart/form-data" id="uploadForm" class="space-y-10">
        {% csrf_token %}

        <!-- MASTER UPLOAD -->
        <div>
            <label class="text-lg font-semibold">Master BOM (.xlsx)</label>

            <div id="masterDrop"
                class="mt-3 border-2 border-dashed border-gray-300 p-8 rounded-xl bg-gray-50 text-center
                       transition hover:border-indigo-500 hover:bg-indigo-50 cursor-pointer">

                <input type="file" name="master_file" id="masterFile" accept=".xlsx" hidden>

                <p class="text-gray-500">Drag & drop your master file here, or click to select</p>
                <p class="text-sm text-gray-400 mt-2">Required format: .xlsx</p>
            </div>

            <p id="masterPreview" class="mt-2 text-sm text-gray-700"></p>
        </div>

        <!-- TARGET UPLOAD -->
        <div>
            <label class="text-lg font-semibold">Target Files (1â€“5 files)</label>

            <div id="targetDrop"
                class="mt-3 border-2 border-dashed border-gray-300 p-8 rounded-xl bg-gray-50 text-center
                       transition hover:border-indigo-500 hover:bg-indigo-50 cursor-pointer">

                <input type="file" name="target_files" id="targetFiles" multiple
                       accept=".xlsx,.csv,.txt,.docx,.pdf" hidden>

                <p class="text-gray-500">Drag & drop target files here, or click to select</p>
                <p class="text-sm text-gray-400 mt-2">Allowed: XLSX, CSV, PDF, TXT, DOCX</p>
            </div>

            <ul id="targetPreview" class="mt-3 text-sm text-gray-700 space-y-1"></ul>
        </div>

        <button class="w-full py-4 text-lg bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl transition">
            Compare BOMs
        </button>
    </form>

</div>

<script>
// ---------- Master Upload ----------
const masterDrop = document.getElementById("masterDrop");
const masterInput = document.getElementById("masterFile");
const masterPreview = document.getElementById("masterPreview");

masterDrop.onclick = () => masterInput.click();
masterDrop.ondragover = e => e.preventDefault();
masterDrop.ondrop = e => {
    e.preventDefault();
    masterInput.files = e.dataTransfer.files;
    updateMasterPreview();
};
masterInput.onchange = updateMasterPreview;

function updateMasterPreview() {
    if (masterInput.files.length > 0) {
        masterPreview.textContent = "ðŸ“„ " + masterInput.files[0].name;
    }
}

// ---------- Target Upload ----------
const targetDrop = document.getElementById("targetDrop");
const targetInput = document.getElementById("targetFiles");
const targetPreview = document.getElementById("targetPreview");

targetDrop.onclick = () => targetInput.click();
targetDrop.ondragover = e => e.preventDefault();
targetDrop.ondrop = e => {
    e.preventDefault();
    targetInput.files = e.dataTransfer.files;
    updateTargetPreview();
};
targetInput.onchange = updateTargetPreview;

function updateTargetPreview() {
    targetPreview.innerHTML = "";
    Array.from(targetInput.files).forEach(f => {
        targetPreview.innerHTML += `<li>ðŸ“„ ${f.name}</li>`;
    });
}
</script>

{% endblock %}
